<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Add Event</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">
    <style>
        #map {
            width: 100%;
            height: 500px;
            margin-top: 20px;
        }
    </style>
    <script type="text/javascript">
        let ticketCount = 1;

        function addTicketForm() {
            var ticketForm = document.getElementById('ticketFormTemplate').cloneNode(true);
            ticketForm.style.display = 'block';
            ticketForm.removeAttribute('id');
            ticketForm.querySelectorAll('input').forEach(input => {
                input.name = input.name.replace('[0]', '[' + ticketCount + ']');
                input.id = input.id.replace('0', ticketCount);
            });
            ticketForm.querySelectorAll('label').forEach(label => {
                label.htmlFor = label.htmlFor.replace('0', ticketCount);
            });
            ticketForm.querySelector('.ticket-label').innerText = 'Ticket ' + (ticketCount + 1);
            ticketForm.querySelector('.remove-ticket').setAttribute('onclick', 'removeTicketForm(this)');
            document.getElementById('ticketFormsContainer').appendChild(ticketForm);
            ticketCount++;
        }

        function removeTicketForm(button) {
            button.closest('.ticket-form').remove();
        }
    </script>
    <script src="/js/google-maps-location-picker.js"></script>
    <link th:replace="layout/admin-layout::link">
</head>

<body th:replace="layout/admin-layout::body(title='Add Event', pathname='events')">
<div th:fragment="content" th:with="pathname=${pathname}">
    <div class="mt-3 mb-4">
        <a class="btn btn-primary" th:href="@{/events}">Back</a>
    </div>

    <h5 class="mt-5">Event Details </h5>

    <form th:action="@{/events/create}" th:object="${eventForm}" method="POST" enctype="multipart/form-data">
        <div>
            <label for="title" class="form-label mt-2">Title</label>
            <input type="text" class="form-control mt-2" id="title" name="title" th:classappend="${#fields.hasErrors('title')}? 'is-invalid'" th:field="*{title}">
            <span th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="invalid-feedback">Title Error</span>
        </div>

        <div>
            <label class="form-label mt-4" for="eventType">Event Type</label>
            <select class="form-select" id="eventType" th:field="*{eventType}">
                <option value="" selected disabled>Choose Event Type</option>
                <option th:each="eventType : ${eventTypes}" th:value="${eventType.id}" th:text="${eventType.typeName}"></option>
            </select>
        </div>
        <div>
            <label for="description" class="form-label mt-4">Description</label>
            <textarea class="form-control mt-2" id="description" name="description" th:field="*{description}"></textarea>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label for="startDate" class="form-label mt-4">Start Date</label>
                <input type="date" class="form-control mt-2" id="startDate" name="startDate" th:classappend="${#fields.hasErrors('startDate')}? 'is-invalid'" th:field="*{startDate}">
                <span th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}" class="invalid-feedback">Start Date Error</span>
            </div>
            <div class="col-md-6">
                <label for="endDate" class="form-label mt-4">End Date</label>
                <input type="date" class="form-control mt-2" id="endDate" name="endDate" th:classappend="${#fields.hasErrors('endDate')}? 'is-invalid'" th:field="*{endDate}">
                <span th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}" class="invalid-feedback">End Date Error</span>
            </div>
            <div class="col-md-6">
                <label for="startTime" class="form-label mt-4">Start Time</label>
                <input type="time" class="form-control mt-2" id="startTime" name="startTime" th:classappend="${#fields.hasErrors('startTime')}? 'is-invalid'" th:field="*{startTime}">
                <span th:if="${#fields.hasErrors('startTime')}" th:errors="*{startTime}" class="invalid-feedback">Start Time Error</span>
            </div>

            <div class="col-md-6">
                <label for="endTime" class="form-label mt-4">End Time</label>
                <input type="time" class="form-control mt-2" id="endTime" name="endTime" th:classappend="${#fields.hasErrors('endTime')}? 'is-invalid'" th:field="*{endTime}">
                <span th:if="${#fields.hasErrors('endTime')}" th:errors="*{endTime}" class="invalid-feedback">End Time Error</span>
            </div>
        </div>
        <div>
            <label for="coverPhotoFile" class="form-label mt-4">Cover Photo</label>
            <input type="file" id="coverPhotoFile" name="coverPhotoFile" class="form-control mt-2">
        </div>

        <h5 class="mt-5">Location Details </h5>

        <p class="mt-4">Use the map to select the location</p>
        <div>
            <div id="map"></div>
            <script src="/js/google-maps-location-picker.js"></script>
        </div>

        <div class="row">
            <div class="col-md-4">
                <label for="locationName" class="form-label mt-4">Location Name</label>
                <input type="text" class="form-control mt-2" id="locationName" name="locationName" th:field="*{locationName}">
            </div>
            <div class="col-md-8">
                <label for="locationAddress" class="form-label mt-4">Location Address</label>
                <input type="text" class="form-control mt-2" id="locationAddress" name="locationAddress" th:field="*{locationAddress}">
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <label for="locationPhone" class="form-label mt-4">Location Phone</label>
                <input type="text" class="form-control mt-2" id="locationPhone" name="locationPhone" th:field="*{locationPhone}">
                <label for="locationEmail" class="form-label mt-4">Location Email</label>
                <input type="email" class="form-control mt-2" id="locationEmail" name="locationEmail" th:field="*{locationEmail}">
            </div>
            <div class="col-md-6">
                <label for="locationLatitude" class="form-label mt-4">Location Latitude</label>
                <input type="text" id="locationLatitude" class="form-control mt-2" name="locationLatitude" th:field="*{locationLatitude}">
                <label for="locationLongitude" class="form-label mt-4">Location Longitude</label>
                <input type="text" id="locationLongitude" class="form-control mt-2" name="locationLongitude" th:field="*{locationLongitude}">
            </div>
        </div>

        <h5 class="mt-4">Tickets Details</h5>
        <p>Please add tickets from low to high price.</p>

        <div id="ticketFormsContainer">
            <div class="ticket-form">
                <div>
                    <label class="ticket-label form-label mt-2">Ticket 1</label>
                </div>
                <div>
                    <label for="ticketType0" class="form-label mt-2">Ticket Type</label>
                    <input type="text" class="form-control mt-2" id="ticketType0" name="tickets[0].ticketType" th:field="*{tickets[0].ticketType}">
                </div>
                <div>
                    <label for="ticketDescription0" class="form-label mt-2">Description</label>
                    <input type="text" class="form-control mt-2" id="ticketDescription0" name="tickets[0].description" th:field="*{tickets[0].description}">
                </div>
                <div>
                    <label for="ticketPrice0" class="form-label mt-2">Price</label>
                    <input type="number" class="form-control mt-2" id="ticketPrice0" name="tickets[0].price" th:field="*{tickets[0].price}">
                </div>
                <div>
                    <label for="ticketQuantity0" class="form-label mt-2">Quantity</label>
                    <input type="number" class="form-control mt-2" id="ticketQuantity0" name="tickets[0].quantity" th:field="*{tickets[0].quantity}">
                </div>
                <hr>
            </div>
            <div id="ticketFormTemplate" class="ticket-form" style="display: none;">
                <div>
                    <label class="ticket-label form-label mt-2">Ticket 2</label>
                    <button type="button" class="remove-ticket btn btn-danger btn-sm" onclick="removeTicketForm(this)">x</button>
                </div>
                <div>
                    <label for="ticketTypeTemplate" class="form-label mt-2">Ticket Type</label>
                    <input type="text" class="form-control mt-2" id="ticketTypeTemplate" name="tickets[0].ticketType" th:field="*{tickets[0].ticketType}">
                </div>
                <div>
                    <label for="ticketDescriptionTemplate" class="form-label mt-2">Description</label>
                    <input type="text" class="form-control mt-2" id="ticketDescriptionTemplate" name="tickets[0].description" th:field="*{tickets[0].description}">
                </div>
                <div>
                    <label for="ticketPriceTemplate" class="form-label mt-2">Price</label>
                    <input type="number" class="form-control mt-2" id="ticketPriceTemplate" name="tickets[0].price" th:field="*{tickets[0].price}">
                </div>
                <div>
                    <label for="ticketQuantityTemplate" class="form-label mt-2">Quantity</label>
                    <input type="number" class="form-control mt-2" id="ticketQuantityTemplate" name="tickets[0].quantity" th:field="*{tickets[0].quantity}">
                </div>
                <hr>
            </div>
        </div>

        <a href="javascript:void(0);" onclick="addTicketForm()">Add a new ticket type</a>

        <div>
            <label for="isPublic" class="form-label mt-4">Is Public</label>
            <input type="checkbox" id="isPublic" name="isPublic" th:field="*{isPublic}">
        </div>

        <div class="mt-4">
            <input class="btn btn-success" type="submit" value="Save">
        </div>
    </form>
</div>
</body>
</html>